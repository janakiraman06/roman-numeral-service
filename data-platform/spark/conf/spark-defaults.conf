# ============================================
# Spark Configuration for Roman Numeral Lakehouse
# ============================================
# Configures Spark for Iceberg tables on MinIO (S3-compatible)
# with Iceberg REST Catalog
#
# Compatibility Matrix:
# - Spark: 3.5.0
# - Iceberg: 1.5.2 (iceberg-spark-runtime-3.5_2.12)
# - Iceberg REST Catalog: 1.5.0
# - Java: 17
# ============================================

# Spark SQL Extensions for Iceberg
spark.sql.extensions                                org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions

# Iceberg Catalog Configuration (REST Catalog)
spark.sql.catalog.lakehouse                         org.apache.iceberg.spark.SparkCatalog
spark.sql.catalog.lakehouse.type                    rest
spark.sql.catalog.lakehouse.uri                     http://iceberg-rest:8181
spark.sql.catalog.lakehouse.warehouse               s3://lakehouse/warehouse

# Default Catalog
spark.sql.defaultCatalog                            lakehouse

# S3/MinIO Configuration
spark.hadoop.fs.s3a.endpoint                        http://minio:9000
spark.hadoop.fs.s3a.access.key                      minioadmin
spark.hadoop.fs.s3a.secret.key                      minioadmin123
spark.hadoop.fs.s3a.path.style.access               true
spark.hadoop.fs.s3a.impl                            org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.connection.ssl.enabled          false

# Iceberg Write Settings
spark.sql.catalog.lakehouse.io-impl                 org.apache.iceberg.aws.s3.S3FileIO
spark.sql.catalog.lakehouse.s3.endpoint             http://minio:9000
spark.sql.catalog.lakehouse.s3.path-style-access    true

# Spark Streaming Settings
spark.streaming.stopGracefullyOnShutdown            true
spark.streaming.kafka.maxRatePerPartition           1000

# Memory and Performance
spark.executor.memory                               1g
spark.driver.memory                                 1g
spark.sql.shuffle.partitions                        4

# Checkpointing for Structured Streaming
spark.sql.streaming.checkpointLocation              s3a://lakehouse/checkpoints

# ============================================
# OpenLineage Configuration (Data Lineage)
# ============================================
# Emits lineage events to Marquez for data observability
# See: https://openlineage.io/docs/integrations/spark/
#
# NOTE: Disabled by default. To enable, add the OpenLineage JAR:
#   --packages io.openlineage:openlineage-spark:1.0.0
#
# spark.extraListeners                              io.openlineage.spark.agent.OpenLineageSparkListener
# spark.openlineage.transport.type                  http
# spark.openlineage.transport.url                   http://marquez:5000
# spark.openlineage.namespace                       rns-lakehouse
# spark.openlineage.parentJobName                   spark-etl
# spark.openlineage.parentRunId                     ${spark.app.id}
